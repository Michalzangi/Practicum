<!DOCTYPE html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>practicum</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Free HTML5 Template by FREEHTML5.CO" />
    <meta name="keywords" content="free html5, free template, free bootstrap, html5, css3, mobile first, responsive" />
    <meta name="author" content="FREEHTML5.CO" />
    <link rel="shortcut icon" href="favicon.ico">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700,300' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/icomoon.css">
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/superfish.css">
    <link rel="stylesheet" href="css/flexslider.css">
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/bootstrap-datepicker.min.css">
    <link rel="stylesheet" href="css/cs-select.css">
    <link rel="stylesheet" href="css/cs-skin-border.css">
    <link rel="stylesheet" href="css/style.css">

    <style>
        .user-row {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 5px;
        }
        .users-header {
            text-align: center;
            margin-bottom: 30px;
            font-size: 40px;
            font-weight: 400;
            position: relative;
            color:  #de6277; 
        }
        .message-container {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 128, 0, 0.8); /* Green background color */
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 9999;
        }

        .message-container.right {
            right: 50px; /* Adjust the right distance from the side of the page */
        }
 
    </style>

</head>
<body>
    <div id="fh5co-wrapper">
    <div id="fh5co-page">
        <header id="fh5co-header-section" class="sticky-banner">
			<div class="container">
				<div class="nav-header">
					<a href="#" class="js-fh5co-nav-toggle fh5co-nav-toggle dark"><i></i></a>
					<h1 id="fh5co-logo"><a href="HomeManager.html"><i class="icon-home"></i> Heh Bâ€™iyar <span> Real Estate</span></a></h1>
					<nav id="fh5co-menu-wrap" role="navigation">
						<ul class="sf-menu" id="fh5co-primary-menu">
							<li class="active"><a href="HomeManager.html">Home</a></li>
							<li>
								<a>Assets</a>
									<ul class="fh5co-sub-menu">
										<li><a href="all-Manager.html">All</a></li>
										<li><a href="filter-Manager.html">Filter</a></li>
									</ul>
							</li>
							<li><a href="users-Manager.html">Users</a></li>
							<li><a href="blog-Manager.html">Blog</a></li>
							<li>
								<a>Activities</a>
									<ul class="fh5co-sub-menu">
										<li><a href="addP-Manager.html">Add Property</a></li>
										<li><a href="updateP-Manager.html">Update Property</a></li>
										<li><a href="addC-Manager.html">Add a Customer</a></li>
										<li><a href="updateC-Manager.html">Update Customer</a></li>
										<li><a href="addD-Manager.html">Close A Deal</a></li>
									</ul>
							</li>
							<li>
								<a>Meetings</a>
									<ul class="fh5co-sub-menu">
										<li><a href="meetingA-Manager.html">Add</a></li>
										<li><a href="meetingV-Manager.html">View</a></li>
									</ul>
							</li>
						</ul>
					</nav>
				</div>
			</div>
		</header>

        <aside id="fh5co-hero" class="js-fullheight">
            <div class="flexslider js-fullheight">
                <ul class="slides">
                    <li style="background-image: url(images/cov.png);">
                        <div class="overlay"></div>
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-md-8 col-md-offset-2 text-center js-fullheight slider-text">
                                    <div class="slider-text-inner">
                                        <h2 class="heading-title">Manager</h2>
                                        <p class="fh5co-lead"> Coming Soon <i class="icon-heart3"></i> </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </aside>

		<div id="fh5co-blog-section" class="fh5co-section-gray">
            <div class="container">
				<h3 class="users-header">Users</h3>
				<div id="users-container"></div>
				<form id="add-user-form" class="user-row">
                    <h3 class="users-header">Add New User</h3>
                    <div class="form-group">
                        <label for="username">Username:</label>
                        <input type="text" id="username" name="UserName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password:</label>
                        <input type="password" id="password" name="Password" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="Email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone:</label>
                        <input type="tel" id="phone" name="Phone" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-primary" id="sub">Add User</button><br></form>
			</div>
        </div>

        <footer>
            <div id="footer">
                <div class="container">
                    <div class="row row-bottom-padded-md">
                        <div class="col-md-3">
                            <h3 class="section-title">About Us</h3>
                            <p>We, Bar Michal and Nofar, information systems management students at the College of Management, own all the exclusive rights to this website <i class="icon-heart3"></i></p>
                        </div>

                        <div class="col-md-3 col-md-push-1">
                            <h3 class="section-title">Links</h3>
                            <ul>
                                <li><a href="#">Home</a></li>
                                <li><a href="#">Assets</a></li>
                                <li><a href="#">Agent</a></li>
                                <li><a href="#">Blog</a></li>
                                <li><a href="#">Contact</a></li>
                            </ul>
                        </div>

                        <div class="col-md-3">
                            <h3 class="section-title">Information</h3>
                            <ul>
                                <li><a href="#">Terms &amp; Condition</a></li>
                                <li><a href="#">License</a></li>
                                <li><a href="#">Privacy &amp; Policy</a></li>
                                <li><a href="#">Contact Us</a></li>
                            </ul>
                        </div>
                        <div class="col-md-3">
                            <h3 class="section-title">Newsletter</h3>
                            <p>Subscribe for our newsletter</p>
                            <form class="form-inline" id="fh5co-header-subscribe">
                                <div class="row">
                                    <div class="col-md-12 col-md-offset-0">
                                        <div class="form-group">
                                            <input type="text" class="form-control" id="email" placeholder="Enter your email">
                                            <button type="submit" class="btn btn-default"><i class="icon-paper-plane"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <p class="fh5co-social-icons">
                                <a href="#"><i class="icon-twitter2"></i></a>
                                <a href="#"><i class="icon-facebook2"></i></a>
                                <a href="#"><i class="icon-instagram"></i></a>
                                <a href="#"><i class="icon-dribbble2"></i></a>
                                <a href="#"><i class="icon-youtube"></i></a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
       

        </footer>
    </div>
</div>

<script src="js/jquery.min.js"></script>
<script src="js/jquery.easing.1.3.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.waypoints.min.js"></script>
<script src="js/sticky.js"></script>
<script src="js/hoverIntent.js"></script>
<script src="js/superfish.js"></script>
<script src="js/jquery.flexslider-min.js"></script>
<script src="js/bootstrap-datepicker.min.js"></script>
<script src="js/classie.js"></script>
<script src="js/selectFx.js"></script>
<script src="js/main.js"></script>
<script>
	window.onload = async () => {
    try {
        const response = await fetch('/Users');
        const users = await response.json();
        const usersContainer = document.getElementById('users-container');
        usersContainer.innerHTML = '';

        users.forEach(user => {
            addUserToUI(user);
        });
    } catch (error) {
        console.error('Error fetching users:', error);
    }
};

function addUserToUI(user) {
    const usersContainer = document.getElementById('users-container');
    const userElement = document.createElement('div');
    userElement.classList.add('user-row');
    userElement.innerHTML = `
        <p>UserName: ${user.UserName}</p>
        <p>Password: ${user.Password}</p>
        <p>Role: ${user.Role}</p>
        `;
    if (user.Role === 'Admin') {
        userElement.innerHTML += `<button class="delete-btn" style="background-color: pink;" data-id="${user._id}">Delete</button>`;
        userElement.querySelector('.delete-btn').addEventListener('click', async () => {
            const userId = user._id;
            try {
                const response = await fetch(`/Users/${userId}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    userElement.remove(); // Remove the user row from the UI
                } else {
                    console.error('Failed to delete user');
                }
            } catch (error) {
                console.error('Error deleting user:', error);
            }
        });
    }
    usersContainer.appendChild(userElement);
}
document.getElementById('add-user-form').addEventListener('submit', async function(event) {
    event.preventDefault();
    const formData = {};
    const inputs = this.querySelectorAll('input, select');
    inputs.forEach(input => {
        formData[input.name] = input.value;
    });

    // Save username and password to "user" collection
    const userFormData = {
        UserName: formData.UserName,
        Password: formData.Password,
        Role: 'Admin'
    };

    // Save username, email, and phone to "partner" collection
    const partnerFormData = {
        UserName: formData.UserName,
        Email: formData.Email,
        Phone: formData.Phone
    };

    try {
        // Save data to "user" collection
        const userResponse = await fetch('/add-user', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(userFormData)
        });

        if (!userResponse.ok) {
            console.error('Failed to add user to "user" collection');
            return;
        }

        // Save data to "partner" collection
        const partnerResponse = await fetch('/add-partner', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(partnerFormData)
        });

        if (!partnerResponse.ok) {
            console.error('Failed to add user to "partner" collection');
            return;
        }

        // If both saves are successful, show success message
        showMessage('User and partner added successfully', 'success');
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
        document.getElementById('email').value = '';
        document.getElementById('phone').value = '';

        // Refresh the page after 5 seconds
        setTimeout(() => {
            window.location.reload();
        }, 5000);
    } catch (error) {
        console.error('Error adding user:', error);
    }
});

function showMessage(message, type) {
    const messageContainer = document.createElement('div');
    messageContainer.classList.add('message-container');
    messageContainer.textContent = message;
    messageContainer.style.backgroundColor = type === 'success'
    document.body.appendChild(messageContainer);
    setTimeout(() => {
        messageContainer.remove();
    }, 5000);
}

	</script>
</body>
</html>
